import FreeCAD as App
import Part
import math

def create_your_nozzle():
    doc = App.ActiveDocument or App.newDocument()
    
    params = {
        "inlet_dia": 20.0,
        "throat_dia": 3.5,
        "exit_dia": 6.0,
        "conv_length": 10.0,
        "div_length": 15.0,
        "throat_length": 2.0,
        "wall_thickness": 1.0
    }
    
    # محاسبات شعاع
    r_in = params["inlet_dia"] / 2
    r_th = params["throat_dia"] / 2
    r_ex = params["exit_dia"] / 2
    t = params["wall_thickness"]
    
    # پروفیل خارجی
    outer_points = [
        App.Vector(0, r_in, 0),
        App.Vector(-params["conv_length"], r_th, 0),
        App.Vector(-params["conv_length"]-params["throat_length"], r_th, 0),
        App.Vector(-params["conv_length"]-params["throat_length"]-params["div_length"], r_ex, 0),
        App.Vector(-params["conv_length"]-params["throat_length"]-params["div_length"], 0, 0),
        App.Vector(0, 0, 0)
    ]
    outer_wire = Part.makePolygon(outer_points)
    
    # پروفیل داخلی
    inner_points = [
        App.Vector(0, r_in-t, 0),
        App.Vector(-params["conv_length"], max(r_th-t, 0.1), 0),
        App.Vector(-params["conv_length"]-params["throat_length"], max(r_th-t, 0.1), 0),
        App.Vector(-params["conv_length"]-params["throat_length"]-params["div_length"], max(r_ex-t, 0.1), 0),
        App.Vector(-params["conv_length"]-params["throat_length"]-params["div_length"], 0, 0),
        App.Vector(0, 0, 0)
    ]
    inner_wire = Part.makePolygon(inner_points)
    
    # ایجاد نازل
    outer_shell = outer_wire.revolve(App.Vector(0,0,0), App.Vector(1,0,0), 360)
    inner_shell = inner_wire.revolve(App.Vector(0,0,0), App.Vector(1,0,0), 360)
    nozzle = outer_shell.cut(inner_shell)
    
    obj = doc.addObject("Part::Feature", "Nozzle")
    obj.Shape = nozzle
    doc.recompute()
    return obj

nozzle = create_your_nozzle()
