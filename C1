import FreeCAD
import Part
from FreeCAD import Base
import math

# تنظیمات دقیق بر اساس میلیمتر
diameter = 16.0
radius = diameter / 2
length = 80.0
cut_position = 5.0  # فاصله برش از مرکز

# محاسبات دقیق هندسی
y = math.sqrt(radius**2 - cut_position**2)  # ارتفاع نقطه برش

# ایجاد نقاط کلیدی
points = [
    Base.Vector(cut_position, -y, 0),
    Base.Vector(radius, 0, 0),
    Base.Vector(cut_position, y, 0)
]

# ساخت مقطع با دقت بالا
wire = Part.Wire([
    Part.LineSegment(points[0], points[1]).toShape(),
    Part.ArcOfCircle(
        Part.Circle(Base.Vector(0,0,0), Base.Vector(0,0,1), radius),
        -math.asin(y/radius),
        math.asin(y/radius)
    ).toShape(),
    Part.LineSegment(points[2], points[0]).toShape()
])

# ایجاد حجم نهایی
solid = wire.extrude(Base.Vector(0, 0, length))

# نمایش نتیجه
obj = FreeCAD.ActiveDocument.addObject("Part::Feature", "PerfectCylinderPart")
obj.Shape = solid
FreeCADGui.ActiveDocument.ActiveView.viewAxometric()
FreeCADGui.SendMsgToActiveView("ViewFit")
FreeCAD.ActiveDocument.recompute()
